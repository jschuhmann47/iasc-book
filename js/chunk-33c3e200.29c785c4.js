(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-33c3e200"],{"377f":function(e,a,s){e.exports=s.p+"img/node-system.391f5210.png"},4976:function(e,a,s){e.exports=s.p+"img/basic-event-loop.8b8923fb.png"},"599b":function(e,a,s){e.exports=s.p+"img/complete-event-loop.b59ad9a8.png"},bc00:function(e,a,s){e.exports=s.p+"img/v8.826badb9.png"},c3c4:function(e,a,s){"use strict";s.r(a);var o=function(){var e=this,a=e.$createElement;e._self._c;return e._m(0)},n=[function(){var e=this,a=e.$createElement,o=e._self._c||a;return o("section",[o("h2",{attrs:{id:"introducción"}},[e._v("Introducción "),o("a",{staticClass:"header-anchor",attrs:{href:"#introducción"}},[e._v("¶")])]),o("p",[e._v("El "),o("strong",[e._v("event loop")]),e._v(" es la forma que usa Node.js para "),o("strong",[e._v("organizar el procesamiento del código")]),e._v(".")]),o("p",[e._v("Para poder profundizar en el event loop debemos entender de forma high level qué es la V8 y qué relación tiene con node.")]),o("p",[e._v("V8, de forma muy básica, podemos definirlo como uno de los motores de javascript que interpreta y ejecute código js. Todos los browser contienen un motor Js, V8 es el creado por Google.")]),o("p",[e._v("V8 de alguna forma permitia una interpretación mucho más rápida de Javascript de los navegadores, esto gracias a la combinación del uso del interprete y el compilador.")]),o("p",[e._v("Ryah Dahll, como explica en la presentación de "),o("a",{attrs:{href:"https://www.youtube.com/watch?v=ztspvPYybIY&t=1s"}},[e._v("JsConf")]),e._v(", consigue crear servidores web para las necesidades actuales haciendo que la V8 funcione por fuera del navegador, es decir, en el sistema operativo.")]),o("p",[e._v("Motor V8 de javascript:")]),o("ul",[o("li",[e._v("Posee dos componentes principales: "),o("ul",[o("li",[e._v("Heap: Aloca variables, funciones y estructuras.")]),o("li",[e._v("Call Stack : Permite el anidamiento de llamadas.")])])]),o("li",[e._v("Existe un bucle de ejecución")])]),o("img",{staticClass:"center iasc-image",attrs:{src:s("bc00")}}),o("p",[e._v("El bucle que anteriormente nombramos es el EVENT LOOP y es quien nos permite manejar la concurrencia de eventos. ¿Que es un evento? pequeñas funcionalidades/funciones que vamos a ejecutar a lo largo del tiempo..")]),o("p",[o("strong",[e._v("Tiene un modelo de concurrencia orientado a EVENTOS.")])]),o("h3",{attrs:{id:"qué-es-node"}},[e._v("¿Qué es node? "),o("a",{staticClass:"header-anchor",attrs:{href:"#qué-es-node"}},[e._v("¶")])]),o("p",[o("cite",{attrs:{cite:"Node.js Documentation"}},[e._v("As an asynchronous event-driven JavaScript runtime, Node.js is designed to build scalable network applications")])]),o("p",[e._v("Ejemplo en node de un contador:")]),o("pre",{pre:!0},[o("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[o("span",{pre:!0,attrs:{class:"hljs-keyword"}},[e._v("var")]),e._v(" a = "),o("span",{pre:!0,attrs:{class:"hljs-number"}},[e._v("0")]),e._v(";\n\n"),o("span",{pre:!0,attrs:{class:"hljs-keyword"}},[e._v("for")]),e._v(" ("),o("span",{pre:!0,attrs:{class:"hljs-keyword"}},[e._v("let")]),e._v(" i = "),o("span",{pre:!0,attrs:{class:"hljs-number"}},[e._v("0")]),e._v("; i < "),o("span",{pre:!0,attrs:{class:"hljs-number"}},[e._v("10000")]),e._v("; i++) {\n    setImmediate("),o("span",{pre:!0,attrs:{class:"hljs-function"}},[o("span",{pre:!0,attrs:{class:"hljs-params"}},[e._v("()")]),e._v(" =>")]),e._v(" a +="),o("span",{pre:!0,attrs:{class:"hljs-number"}},[e._v("1")]),e._v(");\n}\n"),o("span",{pre:!0,attrs:{class:"hljs-built_in"}},[e._v("console")]),e._v(".log(a);\n")])]),o("p",[o("strong",[e._v("¿Qué hace el código?")]),e._v(" En una primera instancia podemos pensar que en "),o("code",{pre:!0},[e._v("a")]),e._v(" se incrementa uno a uno y luego imprimimos la variable con 10000.")]),o("p",[e._v("¿Qué pensamos que hace el setImmediate? ¿Lo ejecuta inmediatamente?")]),o("p",[e._v("El "),o("code",{pre:!0},[e._v("immediate")]),e._v(" lo que hace es generar un evento, es decir, se generan eventos que se van ejecutando en el bucle de event loop.")]),o("p",[e._v("Si lo ejecutamos, vamos a notar que imprime 0.")]),o("p",[o("strong",[e._v("¿Qué pasó?")])]),o("p",[e._v("Los eventos, a diferencia de las "),o("code",{pre:!0},[e._v("corutinas")]),e._v(", se planifican automáticamente, tenemos como ventaja el poder delegar esos detalles, ya que el modelo está más implícito.")]),o("p",[o("strong",[e._v("Cada evento es un contexto de ejecución distinto.")]),e._v(" Nuestra pregunta puede ser ¿Cuándo se produce un cambio de contexto?")]),o("p",[e._v("En el ejemplo del contador, podemos decir que encolamos 10000 veces ese evento y nos da la sensación que estas son llamadas "),o("em",[e._v("sincrónicas")]),e._v(", pero realmente esto no pasa. Por atrás tenemos un elemento que nos permite de alguna forma multiplexar, hacer que el IO que es sincrónico no lo sea.")]),o("p",[e._v("Las interrupciones una vez que llegan, se ejecutan inmediatamente.")]),o("h3",{attrs:{id:"primer-acercamiento-al-evento-loop-high-level"}},[e._v("Primer acercamiento al evento loop - High level "),o("a",{staticClass:"header-anchor",attrs:{href:"#primer-acercamiento-al-evento-loop-high-level"}},[e._v("¶")])]),o("p",[e._v("Podemos pensar que el event loop es un bucle simple en donde los eventos se van ejecutando hasta que en un momento termina.")]),o("img",{staticClass:"center iasc-image",attrs:{src:s("4976")}}),o("p",[e._v("¿Qué pasa si a nuestro anterior ejemplo agrego un "),o("code",{pre:!0},[e._v("console.log")]),e._v(" dentro de otro "),o("code",{pre:!0},[e._v("setImmediate()")]),e._v("?")]),o("pre",{pre:!0},[o("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[o("span",{pre:!0,attrs:{class:"hljs-keyword"}},[e._v("var")]),e._v(" a = "),o("span",{pre:!0,attrs:{class:"hljs-number"}},[e._v("0")]),e._v(";\n\n"),o("span",{pre:!0,attrs:{class:"hljs-keyword"}},[e._v("for")]),e._v(" ("),o("span",{pre:!0,attrs:{class:"hljs-keyword"}},[e._v("let")]),e._v(" i = "),o("span",{pre:!0,attrs:{class:"hljs-number"}},[e._v("0")]),e._v("; i < "),o("span",{pre:!0,attrs:{class:"hljs-number"}},[e._v("10000")]),e._v("; i++) {\n    setImmediate("),o("span",{pre:!0,attrs:{class:"hljs-function"}},[o("span",{pre:!0,attrs:{class:"hljs-params"}},[e._v("()")]),e._v(" =>")]),e._v(" a +="),o("span",{pre:!0,attrs:{class:"hljs-number"}},[e._v("1")]),e._v(");\n}\nsetImmediate("),o("span",{pre:!0,attrs:{class:"hljs-built_in"}},[e._v("console")]),e._v(".log(a));\n")])]),o("p",[e._v("Alternativas:")]),o("ul",[o("li",[e._v("Log con 10000")]),o("li",[e._v("Log con 0")]),o("li",[e._v("Resultados no deterministicos.")])]),o("p",[o("strong",[e._v("Realidad")]),e._v(": Si lo ejecuto me termina dando 10.000, aparentemente se encolan y se van ejecutando en el orden correcto.")]),o("p",[e._v("¿Por qué sucede esto?")]),o("p",[e._v("El event loop es una especie de bucle que tiene varias etapas, y tienen algunas ya prefijadas")]),o("img",{staticClass:"center iasc-image",attrs:{src:s("599b")}}),o("p",[e._v("Son pequeñas etapas, y por cada uno de estos ciclos va a procesar eventos de diferentes naturalezas. El orden de estos ciclos es determinístico.")]),o("p",[e._v("A la cajita de Js, podemos interpretarlas como el código de JS principal de nuestra app.")]),o("p",[e._v("Cambiando un poco el ejemplo")]),o("pre",{pre:!0},[o("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[o("span",{pre:!0,attrs:{class:"hljs-keyword"}},[e._v("var")]),e._v(" a = "),o("span",{pre:!0,attrs:{class:"hljs-number"}},[e._v("0")]),e._v(";\n\n"),o("span",{pre:!0,attrs:{class:"hljs-keyword"}},[e._v("for")]),e._v(" ("),o("span",{pre:!0,attrs:{class:"hljs-keyword"}},[e._v("let")]),e._v(" i = "),o("span",{pre:!0,attrs:{class:"hljs-number"}},[e._v("0")]),e._v("; i < "),o("span",{pre:!0,attrs:{class:"hljs-number"}},[e._v("10000")]),e._v("; i++) {\n    setImmediate("),o("span",{pre:!0,attrs:{class:"hljs-function"}},[o("span",{pre:!0,attrs:{class:"hljs-params"}},[e._v("()")]),e._v(" =>")]),e._v(" a +="),o("span",{pre:!0,attrs:{class:"hljs-number"}},[e._v("1")]),e._v(");\n}\nsetTimeout("),o("span",{pre:!0,attrs:{class:"hljs-function"}},[o("span",{pre:!0,attrs:{class:"hljs-params"}},[e._v("()")]),e._v("=>")]),e._v(" {\n    "),o("span",{pre:!0,attrs:{class:"hljs-built_in"}},[e._v("console")]),e._v(".log("),o("span",{pre:!0,attrs:{class:"hljs-string"}},[e._v("'Dentro del timeout'")]),e._v(");\n    "),o("span",{pre:!0,attrs:{class:"hljs-built_in"}},[e._v("console")]),e._v(".log(a);\n}, "),o("span",{pre:!0,attrs:{class:"hljs-number"}},[e._v("3300")]),e._v(");\n\n"),o("span",{pre:!0,attrs:{class:"hljs-built_in"}},[e._v("console")]),e._v(".log(a);\n")])]),o("p",[e._v("Si ejecuto este código me da 0.")]),o("p",[e._v("Esto sucede ya que se lee todo el código, y el resto de los eventos se planifica después.")]),o("p",[e._v("El bucle se ejecuta en un tiempo específico por lo cual se le asigna una cantidad determinada de tiempo a cada una de sus etapas, justamente porque estamos corriendo sobre solo un thread, en consecuencia solo lo podemos planificar en un solo procesador.")]),o("p",[o("strong",[e._v("¿Qué pasa si en alguna de esas cajitas de JS tenemos una ejecución CPU Intensive?")])]),o("p",[e._v("El sistema operativo ve a node como un solo thread. Tanto lo CPU intensive como elementos sincronicos puedem hacer que todas las fases se demoren y bloqueen. Este thread tiene una política de no desalojo de la ejecución si la misma es de código js, por más que se asignen pequeñas porciones de tiempo a cada etapa del event loop si tenemos elemento que bloquean la CPU, no nos permite que el schedule pueda correr y dar paso a la nueva etapa.")]),o("p",[o("cite",{attrs:{cite:"What is the event loop"}},[e._v("The event loop is what allows Node.js to perform non-blocking I/O operations — despite the fact that JavaScript is single-threaded — by offloading operations to the system kernel whenever possible")])]),o("h3",{attrs:{id:"componentes-de-nuestro-sistema-nodejs"}},[e._v("Componentes de nuestro sistema Node.js "),o("a",{staticClass:"header-anchor",attrs:{href:"#componentes-de-nuestro-sistema-nodejs"}},[e._v("¶")])]),o("img",{staticClass:"center iasc-image",attrs:{src:s("377f")}}),o("p",[e._v("Podemos observar que tiene una queue de eventos general que el event loop va a ir tratando.")]),o("p",[e._v("LIBUV: Es una lib que nos permite wrappear las llamadas bloqueantes en no bloqueantes, esto puede lograrse a través de los llamados worker threads. Estos van a ejecutar estas llamadas y una vez que las terminen de tratar mediante el callback vuelven evento entrando el event queue. Esta lib va a tratar todas las operaciones bloqueantes como pueden ser escuchar un puerto, leer archivos, entre otras operaciones.")]),o("img",{staticClass:"center iasc-image",attrs:{src:s("599b")}}),o("p",[e._v("¿Cómo serian los pasos de nuestro event loop?")]),o("ul",[o("li",[e._v("Escaneo un nuestro código principal (index.js) "),o("ul",[o("li",[e._v("Ejecuta todas las operaciones que se puedan ejecutar inmediatamente.")]),o("li",[e._v("Si en el index detecta eventos: continuaciones, operaciones asincrónicas u operaciones IO, los atiende después, es decir, los encola.")])])]),o("li",[e._v("Terminada la lectura del index, comienza a ciclar por una secuencia bien definida. Atiende timeouts, IO, de red, immediate y eventos de cierre de recursos. "),o("ul",[o("li",[e._v("En esta etapa existen microqueues (JS) donde se fija si existen eventos encolados que están listos para ser procesados, y los ejecuta. (**1)")])])]),o("li",[e._v("Si no tiene más nada que ejecutar, termina el ciclo y la ejecución, caso contrario, arranca nuevamente el ciclo.")])]),o("p",[e._v("(**1) Es una cola de tareas que los worker threads van tomando desde ese punto y cuando está listo ese procesamiento vuelve a encolar en la cola de eventos del event loop.")]),o("p",[o("strong",[e._v("IMPORTANTE")]),e._v(": No debemos bloquear el event loop")]),o("p",[e._v("Si tengo operaciones CPU intensive debemos considerar:")]),o("ul",[o("li",[e._v("Partitioning.")]),o("li",[e._v("Offloading.")]),o("li",[e._v("Uso de funciones de worker threads.")])]),o("p",[e._v("Lo que en nuestro gráfico simplificado nombramos como "),o("em",[e._v("función unicornio")]),e._v(" (este es un nombre inventado por nosotros, no existe tal nomenclatura) permite aprovechar funciones del sistema operativo, es una especie de listener el cual cuando se termina de procesar un elemento o existen nuevos eventos, dicha funcion puede ser de nexo e informar cuando suceden estas cosas. (libuv y SO).")]),o("h2",{attrs:{id:"resumen-de-event-loop"}},[e._v("Resumen de event loop "),o("a",{staticClass:"header-anchor",attrs:{href:"#resumen-de-event-loop"}},[e._v("¶")])]),o("ul",[o("li",[e._v("Forma de organizar el procesamiento del código en Node.js .")]),o("li",[e._v("Se basa en procesamiento concurrente de código js con 1 solo thread, con no-desalojo para código js.")]),o("li",[e._v("Tiene 3 pasos "),o("ul",[o("li",[e._v("Escanea el index, donde ejecuta todo el código que se pueda ejecutar inmediatamente, encolando continuations, io,etc")]),o("li",[e._v("Terminado el escaneo, ciclea en la siguiente secuencia, tieniendo microquues donde revisa si existen eventos preparados para ser ejecutados, y los ejecuta. "),o("ul",[o("li",[e._v("Atiende operaciones asincrónicas,timeouts")]),o("li",[e._v("IO y redes")]),o("li",[e._v("immediate")]),o("li",[e._v("eventos de cierra de recursos")])])]),o("li",[e._v("Si no tiene más que ejecutar, cierra la ejecución, caso contrario, vuelve a retomar el ciclo.")])])]),o("li",[e._v("Tiene 1 hilo , pero n workers que se encargan de ejecutar las tareas pesadas.")])]),o("h3",{attrs:{id:"referencias"}},[e._v("Referencias "),o("a",{staticClass:"header-anchor",attrs:{href:"#referencias"}},[e._v("¶")])]),o("ul",[o("li",[o("a",{attrs:{href:"https://www.youtube.com/watch?v=PNa9OMajw9w"}},[e._v("Morning Keynote- Everything You Need to Know About Node.js Event Loop - Bert Belder, IBM")])]),o("li",[o("a",{attrs:{href:"https://www.youtube.com/watch?v=ztspvPYybIY&t=1s"}},[e._v("Ryan Dahl: Original Node.js presentation - JsConf")])]),o("li",[o("a",{attrs:{href:"https://www.youtube.com/watch?v=_c51fcXRLGw"}},[e._v("Introduction to libuv: What's a Unicorn Velociraptor? - Colin Ihrig, Joyent")])]),o("li",[o("a",{attrs:{href:"https://nodejs.org/en/docs/guides/dont-block-the-event-loop/"}},[e._v("Don't Block the Event Loop (or the Worker Pool)")])]),o("li",[o("a",{attrs:{href:"https://nodejs.dev/learn"}},[e._v("Introduction to Node.js")])]),o("li",[o("a",{attrs:{href:"https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/#what-is-the-event-loop"}},[e._v("What is the event loop")])])])])}],t=s("2877"),r={},i=Object(t["a"])(r,o,n,!1,null,null,null);a["default"]=i.exports}}]);
//# sourceMappingURL=chunk-33c3e200.29c785c4.js.map